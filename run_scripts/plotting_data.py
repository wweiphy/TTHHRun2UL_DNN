
# 2017

# python plotting_data.py -i Eval_0523_UL_nominal -o data_2016post -c ge4j_ge3t -v variables -n ge4j_ge3t_ttH --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc

# python plotting_data.py -i Eval_0515_UL_nominal -o data_2016pre -c ge4j_ge3t -v variables -n ge4j_ge3t_ttH --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc


# python plotting_data.py -i Eval_0119_UL_nominal -o data_2017_allMC -c ge4j_ge3t -v variables -n ge4j_ge3t_ttH --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc

# python plotting_data.py -i Eval_0308_UL_nominal -o data_2018 -c ge4j_ge3t -v variables -n ge4j_ge3t_ttH --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc

# python plotting_data.py -i Control_0409_data -o data -c ge4j_2t --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc

# python plotting_data.py -i Control_0822_2017_data -o data_2017 -c ge4j_2t --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc

# 17&18
# python plotting_data.py -i Control_1718_data -o data_1718 -c ge4j_2t --epochs=500 --signalclass=ttHH -f 0.2 -v variables -n ge4j_ge3t_ttH --plot --printroc




# hadd

# hadd output_limit.root data_2016pre_ge4j_ge3t/plots/data_variables.root tt_2016pre_ge4j_ge3t/plots/tt_variables.root tt4b_2016pre_ge4j_ge3t/plots/tt4b_variables.root ttbb_2016pre_ge4j_ge3t/plots/ttbb_variables.root ttH_2016pre_ge4j_ge3t/plots/ttH_variables.root ttHH_2016pre_ge4j_ge3t/plots/ttHH_variables.root ttZ_2016pre_ge4j_ge3t/plots/ttZ_variables.root ttZH_2016pre_ge4j_ge3t/plots/ttZH_variables.root ttZZ_2016pre_ge4j_ge3t/plots/ttZZ_variables.root

# hadd output_limit.root data_2016post_ge4j_ge3t/plots/data_variables.root tt_2016post_ge4j_ge3t/plots/tt_variables.root tt4b_2016post_ge4j_ge3t/plots/tt4b_variables.root ttbb_2016post_ge4j_ge3t/plots/ttbb_variables.root ttH_2016post_ge4j_ge3t/plots/ttH_variables.root ttHH_2016post_ge4j_ge3t/plots/ttHH_variables.root ttZ_2016post_ge4j_ge3t/plots/ttZ_variables.root ttZH_2016post_ge4j_ge3t/plots/ttZH_variables.root ttZZ_2016post_ge4j_ge3t/plots/ttZZ_variables.root

# 2018
# hadd output_limit.root data_2018_ge4j_ge3t/plots/data_variables.root tt_2018_ge4j_ge3t/plots/tt_variables.root tt4b_2018_ge4j_ge3t/plots/tt4b_variables.root ttbb_2018_ge4j_ge3t/plots/ttbb_variables.root ttH_2018_ge4j_ge3t/plots/ttH_variables.root ttHH_2018_ge4j_ge3t/plots/ttHH_variables.root ttZ_2018_ge4j_ge3t/plots/ttZ_variables.root ttZH_2018_ge4j_ge3t/plots/ttZH_variables.root ttZZ_2018_ge4j_ge3t/plots/ttZZ_variables.root

# 2017
# hadd output_limit.root data_2017_ge4j_ge3t/plots/data_variables.root tt_2017_ge4j_ge3t/plots/tt_variables.root tt4b_2017_ge4j_ge3t/plots/tt4b_variables.root ttbb_2017_ge4j_ge3t/plots/ttbb_variables.root ttH_2017_ge4j_ge3t/plots/ttH_variables.root ttHH_2017_ge4j_ge3t/plots/ttHH_variables.root ttZ_2017_ge4j_ge3t/plots/ttZ_variables.root ttZH_2017_ge4j_ge3t/plots/ttZH_variables.root ttZZ_2017_ge4j_ge3t/plots/ttZZ_variables.root

# hadd output_limit.root data_2017_allMC_ge4j_ge3t/plots/data_variables.root tt_2017_ge4j_ge3t/plots/tt_variables.root tt4b_2017_2_ge4j_ge3t/plots/tt4b_variables.root ttbb_2017_ge4j_ge3t/plots/ttbb_variables.root ttH_2017_ge4j_ge3t/plots/ttH_variables.root ttHH_2017_ge4j_ge3t/plots/ttHH_variables.root ttZ_2017_ge4j_ge3t/plots/ttZ_variables.root ttZH_2017_ge4j_ge3t/plots/ttZH_variables.root ttZZ_2017_ge4j_ge3t/plots/ttZZ_variables.root

# 2018 control region
# hadd output_limit.root data_ge4j_2t/plots/data_variables.root tt_3_ge4j_2t/plots/tt_variables.root tt4b_3_ge4j_2t/plots/tt4b_variables.root ttbb_3_ge4j_2t/plots/ttbb_variables.root ttH_3_ge4j_2t/plots/ttH_variables.root ttHH_3_ge4j_2t/plots/ttHH_variables.root ttZ_3_ge4j_2t/plots/ttZ_variables.root ttZH_3_ge4j_2t/plots/ttZH_variables.root ttZZ_3_ge4j_2t/plots/ttZZ_variables.root

# hadd output_limit.root data_ge4j_2t/plots/data_variables.root tt_2018_rescale_ge4j_2t/plots/tt_variables.root tt4b_4_rescale_ge4j_2t/plots/tt4b_variables.root ttbb_4_rescale_ge4j_2t/plots/ttbb_variables.root ttH_2018_rescale_ge4j_2t/plots/ttH_variables.root ttHH_2018_rescale_ge4j_2t/plots/ttHH_variables.root ttZ_2018_rescale_ge4j_2t/plots/ttZ_variables.root ttZH_2018_rescale_ge4j_2t/plots/ttZH_variables.root ttZZ_2018_rescale_ge4j_2t/plots/ttZZ_variables.root

# 2017 control region
# hadd output_limit.root data_2017_ge4j_2t/plots/data_variables.root tt_2017_ge4j_2t/plots/tt_variables.root tt4b_2017_ge4j_2t/plots/tt4b_variables.root ttbb_2017_ge4j_2t/plots/ttbb_variables.root ttH_2017_ge4j_2t/plots/ttH_variables.root ttHH_2017_ge4j_2t/plots/ttHH_variables.root ttZ_2017_ge4j_2t/plots/ttZ_variables.root ttZH_2017_ge4j_2t/plots/ttZH_variables.root ttZZ_2017_ge4j_2t/plots/ttZZ_variables.root

# hadd output_limit.root data_2017_ge4j_2t/plots/data_variables.root tt_2017_ge4j_2t/plots/tt_variables.root tt4b_2017_rescale_ge4j_2t/plots/tt4b_variables.root ttbb_2017_rescale_ge4j_2t/plots/ttbb_variables.root ttH_2017_ge4j_2t/plots/ttH_variables.root ttHH_2017_ge4j_2t/plots/ttHH_variables.root ttZ_2017_ge4j_2t/plots/ttZ_variables.root ttZH_2017_ge4j_2t/plots/ttZH_variables.root ttZZ_2017_ge4j_2t/plots/ttZZ_variables.root

# 17&18
# hadd output_limit.root data_1718_ge4j_2t/plots/data_variables.root tt_1718_ge4j_2t/plots/tt_variables.root tt4b_1718_ge4j_2t/plots/tt4b_variables.root ttbb_1718_test_ge4j_2t/plots/ttbb_variables.root ttH_1718_ge4j_2t/plots/ttH_variables.root ttHH_1718_ge4j_2t/plots/ttHH_variables.root ttZ_1718_ge4j_2t/plots/ttZ_variables.root ttZH_1718_ge4j_2t/plots/ttZH_variables.root ttZZ_1718_ge4j_2t/plots/ttZZ_variables.root

# hadd output_limit.root data_1718_ge4j_2t/plots/data_variables.root tt_1718_ge4j_2t/plots/tt_variables.root tt4b_1718_rescale_ge4j_2t/plots/tt4b_variables.root ttbb_1718_rescale_ge4j_2t/plots/ttbb_variables.root ttH_1718_ge4j_2t/plots/ttH_variables.root ttHH_1718_ge4j_2t/plots/ttHH_variables.root ttZ_1718_ge4j_2t/plots/ttZ_variables.root ttZH_1718_ge4j_2t/plots/ttZH_variables.root ttZZ_1718_ge4j_2t/plots/ttZZ_variables.root


# global imports
# import ROOT
# ROOT.PyConfig.IgnoreCommandLineOptions = True
import os
import sys
import optparse
import json
# local imports
filedir = os.path.dirname(os.path.realpath(__file__))
basedir = os.path.dirname(filedir)
sys.path.append(basedir)

import optionHandler
options = optionHandler.optionHandler(sys.argv)

# local imports
filedir = os.path.dirname(os.path.realpath(__file__))
basedir = os.path.dirname(filedir)
sys.path.append(basedir)

# import class for DNN training
import DNN_framework.DNN as DNN
import DNN_framework.data_frame as df

options.initArguments()


input_samples = df.InputSamples(options.getInputDirectory(), options.getTestPercentage())

weight_expr = "x.Weight_XS * x.lumiWeight"
# weight_expr = "x.Weight_XS * x.Weight_CSV_UL * x.Weight_GEN_nom * x.lumiWeight"

# input_samples.addSample(options.getDefaultName("ttHH"),  label = "ttHH",  normalization_weight = options.getNomWeight(), train_weight = 1, total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttmb"),  label = "ttmb",  normalization_weight = 61., total_weight_expr = weight_expr)
# # input_samples.addSample(options.getDefaultName("ttmb"),  label = "ttmb",  normalization_weight = 6.1, total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttcc"), label = "ttcc", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttlf"), label = "ttlf", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttnb"), label = "ttnb", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttH"), label = "ttH", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttZH"), label = "ttZH", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttZZ"), label = "ttZZ", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)
# input_samples.addSample(options.getDefaultName("ttZ"), label = "ttZ", normalization_weight = options.getNomWeight(), total_weight_expr = weight_expr)

# input_samples.addSample(options.getDefaultName("singlemuon_2017"), label="SingleMuon",
                        # normalization_weight=1., total_weight_expr=weight_expr)
# input_samples.addSample(options.getDefaultName("eledata_2017"), label="SingleElectron",
                        # normalization_weight=1., total_weight_expr=weight_expr)
input_samples.addSample(options.getDefaultName("singlemuon_2018_2"), label="SingleMuon",
                        normalization_weight=1., total_weight_expr=weight_expr)
input_samples.addSample(options.getDefaultName("eledata_2018"), label="SingleElectron",
                        normalization_weight=1., total_weight_expr=weight_expr)


# init DNN class
# dnn = DNN.DNN(
# save_path=outPath,
# # sample_save_path=sample_save_path,
# input_samples=input_samples,
# lumi = 119.4,
# # lumi = 41.5,
# category_name=config["JetTagCategory"],
# train_variables=config["trainVariables"],
# Do_Evaluation = True,
# shuffle_seed=config["shuffleSeed"],
# addSampleSuffix=config["addSampleSuffix"],
# )

dnn = DNN.DNN(
    save_path       = options.getOutputDir(),
    input_samples   = input_samples,
    category_name   = options.getCategory(),
    train_variables = options.getTrainVariables(),
    # number of epochs
    lumi = 119.4,
    # lumi=67.24,  # 2016post
    # lumi = 78.08, # 2016pre
    # lumi = 83, # 2017
    # lumi = 202.4, # 17&18
    train_epochs    = options.getTrainEpochs(),
    # metrics for evaluation (c.f. KERAS metrics)
    eval_metrics    = ["acc"],
    Do_Evaluation   = False,
    Do_plotting = True,
    # percentage of train set to be used for testing (i.e. evaluating/plotting after training)
    test_percentage = options.getTestPercentage(),
    # balance samples per epoch such that there amount of samples per category is roughly equal
    # balanceSamples  = options.doBalanceSamples(),
    evenSel         = options.doEvenSelection()
    )



dnn.save_DNNInput(node_cls="data", isData=True) 
